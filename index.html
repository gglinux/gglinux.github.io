<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Mondax:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="blog 架构设计 软件开发" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="恭喜发财">
<meta property="og:type" content="website">
<meta property="og:title" content="gglinux&#39;s blog">
<meta property="og:url" content="http://gglinux.com/index.html">
<meta property="og:site_name" content="gglinux&#39;s blog">
<meta property="og:description" content="恭喜发财">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gglinux&#39;s blog">
<meta name="twitter:description" content="恭喜发财">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>







  <title> gglinux's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3771f5899dee08d150637df249f1955b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">gglinux's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2019/02/22/phpexcel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/22/phpexcel/" itemprop="url">
                  导出数据到Excel的实用方案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/22/phpexcel/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/02/22/phpexcel/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/22/phpexcel/" class="leancloud_visitors" data-flag-title="导出数据到Excel的实用方案">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="处理前-库的选择"><a href="#处理前-库的选择" class="headerlink" title="处理前-库的选择"></a>处理前-库的选择</h3><p>实际工作场景中，经常需要将系统中数据导出为Excel，便于产品和运营查阅和二次处理。本文详细介绍了使用PHP导出数据的方法。</p>
<p>PHP操作Excel主要有两个第三方库，一个是<a href="https://github.com/PHPOffice/PHPExcel" target="_blank" rel="noopener">PHPExcel</a>，另外一个是<a href="https://github.com/PHPOffice/PhpSpreadsheet" target="_blank" rel="noopener">PhpSpreadsheet</a>。其中PhpSpreadsheet是PHPExcel的升级版本。</p>
<p>PHPExcel本身支持超链接、样式设置（字体、颜色、边框线、对齐等）、行高列宽设置、表格冻结、公式、合并单元格、多表格等特性。从官方文档得知，PHPExcel支持PHP5.2版本，代码质量和性能会低于PhpSpreadsheet。另外PHPExcel从2015年便不再维护，因此很难从社区增加新特性和处理历史缺陷。PHPExcel支持xls和xlsx两种格式，xls是Microsoft Excel 2003以下版本支持的文件，xlsx是Microsoft Excel 2007以后开始的。</p>
<p>PhpSpreadsheet是下一代的PHPExcel，支持PHP5.6及以上，可以处理Microsoft Excel和LibreOffice Calc。PhpSpreadsheet作为下一代的PHPExcel，目前得到社区持续维护。</p>
<p>基于本身业务特点，以及疑难问题的快速处理，最终选择了PHPExcel作为导出的基础库，并且采用xls文件格式。PHPExcel库因为历史久远，积累了很多其他用户踩过的坑，也便于我们处理类似疑难问题。</p>
<blockquote>
<p> 下文所述的方法是将内容导出为xls文件格式。</p>
</blockquote>
<h3 id="处理中-内容的处理"><a href="#处理中-内容的处理" class="headerlink" title="处理中-内容的处理"></a>处理中-内容的处理</h3><h4 id="处理多sheet"><a href="#处理多sheet" class="headerlink" title="处理多sheet"></a>处理多sheet</h4><ul>
<li>核心方法：$obj_phpexcel-&gt;createSheet(​$i);<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$obj_phpexcel = new PHPExcel();</div><div class="line">$sheet_datas;//实际数据</div><div class="line">$sheet_name = &apos;test&apos;;</div><div class="line">foreach($sheet_datas as $i =&gt; $sheet_data) &#123;</div><div class="line">	$obj_phpexcel-&gt;createSheet($i);</div><div class="line">	$obj_phpexcel-&gt;setActiveSheetIndex($sheet_index);</div><div class="line">	$obj_phpexcel-&gt;getActiveSheet()-&gt;setTitle($sheet_name);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="处理样式"><a href="#处理样式" class="headerlink" title="处理样式"></a>处理样式</h4><ul>
<li>核心方法： $obj_phpexcel-&gt;getActiveSheet()-&gt;getStyle(‘A1’)-&gt;applyFromArray($style_array);<br>getStyle的参数为实际坐标，比如A1，代表A列的第1行的单元格。applyFromArray的参数为样式配置。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line">//样式配置</div><div class="line">$style_array = array(</div><div class="line">    &apos;alignment&apos; =&gt; array(</div><div class="line">        &apos;horizontal&apos; =&gt;</div><div class="line">            PHPExcel_Style_Alignment::HORIZONTAL_GENERAL           = &apos;general&apos;</div><div class="line">            PHPExcel_Style_Alignment::HORIZONTAL_LEFT              = &apos;left&apos;</div><div class="line">            PHPExcel_Style_Alignment::HORIZONTAL_RIGHT             = &apos;right&apos;</div><div class="line">            PHPExcel_Style_Alignment::HORIZONTAL_CENTER            = &apos;center&apos;</div><div class="line">            PHPExcel_Style_Alignment::HORIZONTAL_CENTER_CONTINUOUS = &apos;centerContinuous&apos;</div><div class="line">            PHPExcel_Style_Alignment::HORIZONTAL_JUSTIFY           = &apos;justify&apos;</div><div class="line">        &apos;vertical&apos; =&gt;</div><div class="line">            PHPExcel_Style_Alignment::VERTICAL_BOTTOM  = &apos;bottom&apos;</div><div class="line">            PHPExcel_Style_Alignment::VERTICAL_TOP     = &apos;top&apos;</div><div class="line">            PHPExcel_Style_Alignment::VERTICAL_CENTER  = &apos;center&apos;</div><div class="line">            PHPExcel_Style_Alignment::VERTICAL_JUSTIFY = &apos;justify&apos;</div><div class="line">        &apos;rotation&apos; =&gt; (int)</div><div class="line">        &apos;wrap&apos; =&gt; (boolean)</div><div class="line">        &apos;shrinkToFit&apos; =&gt; (boolean)</div><div class="line">        &apos;indent&apos; =&gt; (int)</div><div class="line">    )</div><div class="line">    &apos;borders&apos; =&gt; array(</div><div class="line">        &apos;allborders&apos; =&gt; array(</div><div class="line">            &apos;style&apos; =&gt; </div><div class="line">                PHPExcel_Style_Border::BORDER_NONE               = &apos;none&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_DASHDOT            = &apos;dashDot&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_DASHDOTDOT         = &apos;dashDotDot&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_DASHED             = &apos;dashed&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_DOTTED             = &apos;dotted&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_DOUBLE             = &apos;double&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_HAIR               = &apos;hair&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_MEDIUM             = &apos;medium&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_MEDIUMDASHDOT      = &apos;mediumDashDot&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_MEDIUMDASHDOTDOT   = &apos;mediumDashDotDot&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_MEDIUMDASHED       = &apos;mediumDashed&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_SLANTDASHDOT       = &apos;slantDashDot&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_THICK              = &apos;thick&apos;;</div><div class="line">                PHPExcel_Style_Border::BORDER_THIN               = &apos;thin&apos;;</div><div class="line">            &apos;color&apos; =&gt; array(</div><div class="line">                &apos;rgb&apos; =&gt;</div><div class="line">                    PHPExcel_Style_Color::COLOR_BLACK            = &apos;FF000000&apos;;</div><div class="line">                    PHPExcel_Style_Color::COLOR_WHITE            = &apos;FFFFFFFF&apos;;</div><div class="line">                    PHPExcel_Style_Color::COLOR_RED              = &apos;FFFF0000&apos;;</div><div class="line">                    PHPExcel_Style_Color::COLOR_DARKRED          = &apos;FF800000&apos;;</div><div class="line">                    PHPExcel_Style_Color::COLOR_BLUE             = &apos;FF0000FF&apos;;</div><div class="line">                    PHPExcel_Style_Color::COLOR_DARKBLUE         = &apos;FF000080&apos;;</div><div class="line">                    PHPExcel_Style_Color::COLOR_GREEN            = &apos;FF00FF00&apos;;</div><div class="line">                    PHPExcel_Style_Color::COLOR_DARKGREEN        = &apos;FF008000&apos;;</div><div class="line">                    PHPExcel_Style_Color::COLOR_YELLOW           = &apos;FFFFFF00&apos;;</div><div class="line">                    PHPExcel_Style_Color::COLOR_DARKYELLOW       = &apos;FF808000&apos;;</div><div class="line">            )</div><div class="line"></div><div class="line">        )</div><div class="line">        &apos;left&apos; =&gt; // See &apos;allborders&apos;</div><div class="line">        &apos;top&apos; =&gt; // See &apos;allborders&apos;</div><div class="line">        &apos;right&apos; =&gt; // See &apos;allborders&apos;</div><div class="line">        &apos;bottom&apos; =&gt; // See &apos;allborders&apos;</div><div class="line">        &apos;diagonal&apos; =&gt;</div><div class="line">        &apos;diagonaldirection&apos; =&gt; </div><div class="line">    )</div><div class="line">    &apos;fill&apos; =&gt; array(</div><div class="line">        &apos;type&apos; =&gt;</div><div class="line">            PHPExcel_Style_Fill::FILL_NONE                         = &apos;none&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_SOLID                        = &apos;solid&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_GRADIENT_LINEAR              = &apos;linear&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_GRADIENT_PATH                = &apos;path&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_DARKDOWN             = &apos;darkDown&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_DARKGRAY             = &apos;darkGray&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_DARKGRID             = &apos;darkGrid&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_DARKHORIZONTAL       = &apos;darkHorizontal&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_DARKTRELLIS          = &apos;darkTrellis&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_DARKUP               = &apos;darkUp&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_DARKVERTICAL         = &apos;darkVertical&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_GRAY0625             = &apos;gray0625&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_GRAY125              = &apos;gray125&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_LIGHTDOWN            = &apos;lightDown&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_LIGHTGRAY            = &apos;lightGray&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_LIGHTGRID            = &apos;lightGrid&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_LIGHTHORIZONTAL      = &apos;lightHorizontal&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_LIGHTTRELLIS         = &apos;lightTrellis&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_LIGHTUP              = &apos;lightUp&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_LIGHTVERTICAL        = &apos;lightVertical&apos;;</div><div class="line">            PHPExcel_Style_Fill::FILL_PATTERN_MEDIUMGRAY           = &apos;mediumGray&apos;;</div><div class="line">        &apos;rotation&apos; =&gt; (double)</div><div class="line">        &apos;startcolor&apos; =&gt; // See &apos;borders&apos; =&gt; &apos;allborders&apos; =&gt; &apos;color&apos;</div><div class="line">        &apos;endcolor&apos; =&gt; // See &apos;borders&apos; =&gt; &apos;allborders&apos; =&gt; &apos;color&apos;</div><div class="line">        &apos;color&apos; =&gt; // See &apos;borders&apos; =&gt; &apos;allborders&apos; =&gt; &apos;color&apos;</div><div class="line">    ) </div><div class="line">    &apos;font&apos; =&gt; array(</div><div class="line">        &apos;name&apos; =&gt;</div><div class="line">            &apos;Arial&apos;</div><div class="line">            &apos;Calibri&apos;</div><div class="line">            // etc.</div><div class="line">        &apos;bold&apos; =&gt; (boolean)</div><div class="line">        &apos;italic&apos; =&gt; (boolean)</div><div class="line">        &apos;superScript&apos; =&gt; (boolean)</div><div class="line">        &apos;subScript&apos; =&gt; (boolean)</div><div class="line">        &apos;underline&apos; =&gt; (boolean)</div><div class="line">        &apos;strike&apos; =&gt; (boolean)</div><div class="line">        &apos;size&apos; =&gt; (float)</div><div class="line">        &apos;color&apos; =&gt; // See &apos;borders&apos; =&gt; &apos;allborders&apos; =&gt; &apos;color&apos;</div><div class="line">    )</div><div class="line">    &apos;numberformat&apos; =&gt;</div><div class="line">    &apos;protection&apos; =&gt;</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="写入数据"><a href="#写入数据" class="headerlink" title="写入数据"></a>写入数据</h4><ul>
<li>核心方法：$obj_phpexcel-&gt;getActiveSheet()-&gt;setCellValueExplicit(‘A1’, $value, $dtype);<br>dtype区分不同的数据类型，定义见PHPExcel\Cell\DataType.php<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/* Data types */</div><div class="line">const TYPE_STRING2  = &apos;str&apos;;</div><div class="line">const TYPE_STRING   = &apos;s&apos;;</div><div class="line">const TYPE_FORMULA  = &apos;f&apos;;</div><div class="line">const TYPE_NUMERIC  = &apos;n&apos;;</div><div class="line">const TYPE_BOOL     = &apos;b&apos;;</div><div class="line">const TYPE_NULL     = &apos;null&apos;;</div><div class="line">const TYPE_INLINE   = &apos;inlineStr&apos;;</div><div class="line">const TYPE_ERROR    = &apos;e&apos;;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="处理超链接"><a href="#处理超链接" class="headerlink" title="处理超链接"></a>处理超链接</h4><p>核心方法：$obj_phpexcel-&gt;getActiveSheet()-&gt;getCell(‘A1’)-&gt;getHyperlink()-&gt;setUrl($URL);</p>
<h4 id="处理公式"><a href="#处理公式" class="headerlink" title="处理公式"></a>处理公式</h4><p>核心方法：$obj_phpexcel-&gt;getActiveSheet()-&gt;setCellValue(‘A1’, ‘=SUM(A10:E9)’);</p>
<h4 id="合并单元格"><a href="#合并单元格" class="headerlink" title="合并单元格"></a>合并单元格</h4><p>核心方法：$obj_phpexcel-&gt;getActiveSheet()-&gt;mergeCells(‘A1:C1’);</p>
<h4 id="列宽和行高"><a href="#列宽和行高" class="headerlink" title="列宽和行高"></a>列宽和行高</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//列宽</div><div class="line">$obj_phpexcel-&gt;getActiveSheet()-&gt;getColumnDimension($column_label)-&gt;setWidth($value);</div><div class="line">//行高</div><div class="line">$obj_phpexcel-&gt;getActiveSheet()-&gt;getRowDimension($key)-&gt;setRowHeight($value);</div></pre></td></tr></table></figure>
<h4 id="表格冻结"><a href="#表格冻结" class="headerlink" title="表格冻结"></a>表格冻结</h4><p>核心方法：$obj_phpexcel-&gt;getActiveSheet()-&gt;freezePane(‘D2’);</p>
<h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><h4 id="实际值、像素值隐射"><a href="#实际值、像素值隐射" class="headerlink" title="实际值、像素值隐射"></a>实际值、像素值隐射</h4><p>PHPExcel没办法将像素值，转化为Microsoft Excel实际的宽度和高度值。如果直接将像素值设置为Excel的实际值，会导致内容存在差异。经过测试得知，Excel实际值和像素值之间满足线性关系。知道问题原因，处理起来便很简单。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private function _get_excel_real_width($value) &#123;</div><div class="line">	return $value/7;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="横坐标处理"><a href="#横坐标处理" class="headerlink" title="横坐标处理"></a>横坐标处理</h4><p>Excel的横坐标为A、B….、AA、AB类型，需要将PHP数组下标转化为Excel的横坐标。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">private function _get_sheet_col_label($index) &#123;</div><div class="line"></div><div class="line">	if (isset($this-&gt;_col_label_map[$index])) &#123;</div><div class="line">		return $this-&gt;_col_label_map[$index];</div><div class="line">	&#125;</div><div class="line">	$abc = &apos;ABCDEFGHIJKLMNOPQRSTUVWXYZ&apos;;</div><div class="line">	for ($i=0; $i &lt; 600; $i++) &#123; //最高支持600列</div><div class="line">		$a = (int)($i / 26);</div><div class="line">		$b = $i % 26;</div><div class="line">		$column_label = &apos;&apos;;</div><div class="line">		if ($a == 0) &#123;</div><div class="line">			$column_label = $column_label . substr($abc, $b, 1);</div><div class="line">		&#125; else &#123;</div><div class="line">			$a = $a -1;</div><div class="line">			$column_label = substr($abc, $a, 1) . substr($abc, $b, 1); </div><div class="line">		&#125;</div><div class="line">		$this-&gt;_col_label_map[($i)] = $column_label; </div><div class="line">	&#125;</div><div class="line">	return $this-&gt;_col_label_map[$index];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="默认的样式处理"><a href="#默认的样式处理" class="headerlink" title="默认的样式处理"></a>默认的样式处理</h4><p>Excel本身的表格框线无法通过PHPExcel设置，需要trick处理。另外Excel的样式属性与css样式属性也会有差异，需要注意下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//设置Excel默认框线</div><div class="line"> $style_array = array(</div><div class="line">      &apos;borders&apos; =&gt; array(</div><div class="line">          &apos;allborders&apos; =&gt; array(</div><div class="line">                &apos;style&apos; =&gt; PHPExcel_Style_Border::BORDER_THIN,</div><div class="line">    			&apos;color&apos; =&gt; array(&apos;rgb&apos; =&gt; &apos;DDDDDD&apos;)</div><div class="line">          )</div><div class="line">      )</div><div class="line">  );</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2019/02/22/svg2png/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/22/svg2png/" itemprop="url">
                  前端和后端实现SVG转图片
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/22/svg2png/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/02/22/svg2png/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/02/22/svg2png/" class="leancloud_visitors" data-flag-title="前端和后端实现SVG转图片">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前端方案"><a href="#前端方案" class="headerlink" title="前端方案"></a>前端方案</h2><h3 id="实时保存为Base64"><a href="#实时保存为Base64" class="headerlink" title="实时保存为Base64"></a>实时保存为Base64</h3><p>用户通过界面操作SVG内容，当生成或者编辑SVG时，实时将SVG内容转换成Base64编码的img标签，塞回到原来的DOM节点中。此种方式在前端通过浏览器就可以完成，无须后端的参与。</p>
<p>方案原理是使用canvas做中转，将svg+xml转换成png。在无需后端参与做二次处理时，可以满足业务场景。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">// 前端demo代码</div><div class="line">function drawInlineSVG($svg, callback) &#123;</div><div class="line">    </div><div class="line">    var svg = $svg[0];</div><div class="line">    svg.innerHTML = &apos;&lt;rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;#ffffff&quot;&gt;&lt;/rect&gt;&apos; + svg.innerHTML;</div><div class="line">    var svgData = new XMLSerializer().serializeToString( svg );</div><div class="line"></div><div class="line">    var canvas = document.createElement( &quot;canvas&quot; );</div><div class="line">    var ctx = canvas.getContext( &quot;2d&quot; );</div><div class="line"></div><div class="line">    var img = document.createElement( &quot;img&quot; );</div><div class="line">    img.setAttribute( &quot;src&quot;, &quot;data:image/svg+xml;base64,&quot; + btoa( unescape(encodeURIComponent(svgData)) ) );</div><div class="line"></div><div class="line">    img.onload = function () &#123;</div><div class="line">        ctx.drawImage( img, 0, 0 );</div><div class="line">        canvas.toDataURL( &quot;image/png&quot; );</div><div class="line">        callback &amp;&amp; callback(this);</div><div class="line">    &#125;;</div><div class="line">    var $img = $(img);</div><div class="line"></div><div class="line">    $img.height($svg.height());</div><div class="line">    $img.width($svg.width());</div><div class="line"></div><div class="line">    return $img;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="前端生成png，定时提交到后台"><a href="#前端生成png，定时提交到后台" class="headerlink" title="前端生成png，定时提交到后台"></a>前端生成png，定时提交到后台</h3><p>在需要后台做二次处理时，可以借助于上述的前端方案，通过ajax请求定时、实时的将图片上传到服务器。</p>
<p>原理是使用字符串将base64编码的图片实时上传，在后台再做解码生成图片原型，落地到后台。因为需要实时转换和上传，对后端和前端的压力都比较大。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 前端demo代码</div><div class="line">var data = $(&apos;#canvasimage&apos;).attr(&apos;src&apos;); // Base 64</div><div class="line"></div><div class="line">$.ajax(&#123; </div><div class="line">    type: &quot;POST&quot;, </div><div class="line">    url: url,</div><div class="line">    dataType: &apos;text&apos;,</div><div class="line">    data: &#123;</div><div class="line">        base64data : data</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//后端demo代码</div><div class="line">$data = &apos;data:image/png;base64,AAAFBfj42Pj4&apos;;</div><div class="line"></div><div class="line">list($type, $data) = explode(&apos;;&apos;, $data);</div><div class="line">list(, $data)      = explode(&apos;,&apos;, $data);</div><div class="line">$data = base64_decode($data);</div><div class="line"></div><div class="line">file_put_contents(&apos;/tmp/image.png&apos;, $data);</div></pre></td></tr></table></figure>
<h2 id="后端方案"><a href="#后端方案" class="headerlink" title="后端方案"></a>后端方案</h2><h3 id="引入PHP-imagemagic扩展"><a href="#引入PHP-imagemagic扩展" class="headerlink" title="引入PHP imagemagic扩展"></a>引入PHP imagemagic扩展</h3><p>PHP的imagemagic扩展，可以对SVG操作。使用方法也很简单。但因为imagemagic爆出的安全问题，生产环境一直没有装此扩展。对安全性要求不高的业务，可以使用。<a href="https://www.cvedetails.com/vulnerability-list/vendor_id-1749/Imagemagick.html" target="_blank" rel="noopener">https://www.cvedetails.com/vulnerability-list/vendor_id-1749/Imagemagick.html</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$image = new Imagick();</div><div class="line">$image-&gt;readImageBlob(file_get_contents(&apos;image.svg&apos;));</div><div class="line">$image-&gt;setImageFormat(&quot;png24&quot;);</div><div class="line">$image-&gt;resizeImage(1024, 768, imagick::FILTER_LANCZOS, 1); </div><div class="line">$image-&gt;writeImage(&apos;image.png&apos;);</div></pre></td></tr></table></figure>
<h3 id="引入batik-rasterizer"><a href="#引入batik-rasterizer" class="headerlink" title="引入batik-rasterizer"></a>引入batik-rasterizer</h3><p>batik-rasterizer是Apache基金会下使用Java编写的处理SVG的工具包，要求安装Java 1.6以上的运行时。原理是使用Mozilla Rhino作为JavaScript引擎，生成了一套浏览器环境。<a href="https://xmlgraphics.apache.org/batik/tools/rasterizer.html" target="_blank" rel="noopener">https://xmlgraphics.apache.org/batik/tools/rasterizer.html</a></p>
<p>建议使用最高版本的发布包，高版本对SVG和样式的支持性会更好。目前最新版batik-rasterizer已经支持<style></style>和外部引用CSS样式，但不支持SVG中foreignObject和通过xmlns=”<a href="http://www.w3.org/1999/xhtml&quot;引用HTML标签。" target="_blank" rel="noopener">http://www.w3.org/1999/xhtml&quot;引用HTML标签。</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">## shell调用</div><div class="line">java -jar batik-rasterizer.jar samples/batikFX.svg</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">## PHP调用</div><div class="line">function export($svg, $output_full_path, $type = &apos;png&apos;, $width = null) &#123;</div><div class="line"></div><div class="line">	if (get_magic_quotes_gpc()) &#123;</div><div class="line">		$svg = stripslashes($svg);	</div><div class="line">	&#125;</div><div class="line">	if(strpos($svg,&quot;&lt;!ENTITY&quot;) !== false)&#123;</div><div class="line">		return false;</div><div class="line">	&#125;</div><div class="line">	if ($type == &apos;png&apos;) &#123;</div><div class="line">		$typeString = &apos;-m image/png&apos;;</div><div class="line">		</div><div class="line">	&#125; elseif ($type == &apos;jpeg&apos;) &#123;</div><div class="line">		$typeString = &apos;-m image/jpeg&apos;;</div><div class="line"></div><div class="line">	&#125; elseif ($type == &apos;pdf&apos;) &#123;</div><div class="line">		$typeString = &apos;-m application/pdf&apos;;</div><div class="line">		$ext = &apos;pdf&apos;;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	$svgTmpPathArr = explode(&apos;/&apos;, $output_full_path);</div><div class="line">	unset($svgTmpPathArr[count($svgTmpPathArr)-1]);</div><div class="line"></div><div class="line">	$tempName = time() . rand();</div><div class="line">	$svgTmpPath = implode(&apos;/&apos;, $svgTmpPathArr) . &quot;/$tempName.svg&quot;;</div><div class="line"></div><div class="line">	if (!file_put_contents($svgTmpPath, $svg)) &#123; </div><div class="line">		return false;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	if (!empty($width)) &#123;</div><div class="line">		$width = (int)$width;</div><div class="line">		if ($width) &#123;</div><div class="line">			$width = &quot;-w $width&quot;;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	if(!file_exists($output_full_path)) &#123; </div><div class="line">		$handle = fopen($output_full_path, &quot;w&quot;);</div><div class="line">		fclose($handle);</div><div class="line">	&#125;</div><div class="line">	@shell_exec(&quot;java -jar &quot;.  $batik_rasterizer_path .&quot; $typeString -d $output_full_path $width $svgTmpPath&quot;);</div><div class="line">	unlink($svgTmpPath);</div><div class="line"></div><div class="line">	if (!is_file($output_full_path) || filesize($output_full_path) &lt; 10) &#123;</div><div class="line">		return false;</div><div class="line">	&#125; else &#123;</div><div class="line">		return $output_full_path;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">function transfer_svg_to_images($content) &#123;</div><div class="line">	$images = array();</div><div class="line">	//特殊样式的处理</div><div class="line">	$svg_tag_pattern = &apos;/(&lt;rect[^&lt;]*?)\&gt;\&lt;\/rect\&gt;/i&apos;;</div><div class="line">	$styles = &apos; style=&quot;fill:#ececff; stroke:#9370db; stroke-width:1&quot;&apos;;</div><div class="line">	$content = preg_replace_callback($svg_tag_pattern, function($matches) use($styles) &#123;			</div><div class="line">	 	return str_replace($matches[1], $matches[1] . $styles, $matches[0]);</div><div class="line">	&#125;, $content);</div><div class="line">	//移除不支持标签</div><div class="line">	$svg_tag_pattern = &apos;/(&lt;div xmlns=[^&lt;]*?\&gt;)[\s\S]*?(\&lt;\/div\&gt;)/i&apos;;</div><div class="line">	$content = preg_replace_callback($svg_tag_pattern, function($matches) &#123;		</div><div class="line">	 	$tmp_str = str_replace($matches[1], &apos;&lt;text y=&quot;10&quot;&gt;&apos;, $matches[0]);</div><div class="line">	 	$tmp_str = str_replace($matches[2], &apos;&lt;/text&gt;&apos;,$tmp_str);</div><div class="line">	 	$tmp_str = str_replace(&apos;span&apos;, &apos;tspan&apos;,$tmp_str);</div><div class="line">	 	return $tmp_str;</div><div class="line">	&#125;, $content);</div><div class="line"></div><div class="line">	//移除不支持标签</div><div class="line">	$content = str_replace(&apos;foreignObject&apos;, &apos;g&apos;, $content);</div><div class="line">	$svg_str_pattern = &apos;/\&lt;svg[\s\S]*?\&lt;\/svg\&gt;/i&apos;;//匹配富文本中SVG内容</div><div class="line">	$ret = preg_replace_callback($svg_str_pattern, function($matches) use(&amp;$images) &#123;</div><div class="line">		$image_path =  &apos;/tmp/&apos;. time(). rand() .&apos;svg.png&apos;;</div><div class="line">		$image_path = export($matches[0], $image_path); //实际导出处理</div><div class="line">		$ret_path = null;</div><div class="line">		if(file_exists($image_path))&#123;</div><div class="line">			$images[] = $image_path;</div><div class="line">			$ret_path = &apos;&lt;img src=&quot;&apos; . $image_path . &apos;&quot; /&gt;&apos;;</div><div class="line">		&#125;</div><div class="line">		return $ret_path;</div><div class="line">	&#125;, $content);</div><div class="line">	return array($ret, $images);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h2><p>SVG本身是属于W3C XML的分支，浏览器的实现方式和支持程度也不一样，在后端尤其如此。因为本身的语言标准以及CSS样式控制的问题，导致实际图片和浏览器预览都有差异，往往都需要使用正则对原始SVG文本做hack处理。尤其是后端的两种导出方式。</p>
<p>前端相比后端转换，兼容性和支持性会好很多。当然具体使用那种转换方式，还是需要针对业务场景。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2018/09/09/separate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/09/09/separate/" itemprop="url">
                  老树发新芽-前后端分离实践
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/09/separate/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/09/separate/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/09/09/separate/" class="leancloud_visitors" data-flag-title="老树发新芽-前后端分离实践">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>最早从Web2.0 Ajax技术开始兴起，就有提前后端分离了。从Gmail的单页应用，到现在的单页应用层出不穷。浏览器渲染引擎也一直在突破，越来越多的交互、计算放在了浏览器这一层。传统后端MVC架构，变成了前后端的MVC。后台的接口变成了模型层，逻辑处理层从CGI变成了JavaScript，展示层则还是标记语言HTML和CSS。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/09/09/separate/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2018/08/19/work/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/08/19/work/" itemprop="url">
                  小萌新变身社会人
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/19/work/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/19/work/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/08/19/work/" class="leancloud_visitors" data-flag-title="小萌新变身社会人">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>松浦弥太郎说过，所谓工作就是证明自己有用。很大白话的道理，深表赞同。劳动者付出了劳动，雇佣者给与其报酬。报酬的高低取决于劳动者证明自己有多有用。</p>
<p>工作所需要的技能包含两个层面，其一是专业技能，其二是通用技能。我们能独立完成这项工作，依赖的是专业技能，即工作的专业性。不管是厨师、医生、会计、程序员还是地铁司机，专业度不过关是最难逾越的发展瓶颈。</p>
<p>人和人之间是一个复杂的关系网络，个体的表现不仅需要个人专业能力，还需和群体互动，提升互动效率。这需要沟通表达能力、信息探索能力、阅读写作能力、时间管理能力，还有高情商。对刚毕业的小萌新来说，往往更看重专业技能的探索，忽视通用技能的重要性。因为通用技能的缺失，自己也碰壁过多次。</p>
<p>《软技能–代码之外的生存指南》这本书是在2015年看的，书写的非常好。作者是一名国外的软件工程师，从技术人员的角度撰写的关于软件开发人员的职场发展。15年看完这本书后，对自己的启发也特别大。gglinux.com这个域名也是看完这本书之后决定长期使用的。另外也看过《学会提问-批判性思维指南》。除了这两本书以外，也参加了几场知乎的线上私家课和公司提供的通用技能培训。</p>
<p>综合以前学习到的内容，结合自己的一些实际感悟，做一些总结。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/08/19/work/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2018/03/25/tapd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/25/tapd/" itemprop="url">
                  TAPD和敏捷研发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/25/tapd/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/03/25/tapd/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/03/25/tapd/" class="leancloud_visitors" data-flag-title="TAPD和敏捷研发">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>这篇文章，原计划是去年9月份写的，一直拖到了现在。主要原因在于一直抽不出时间，其次对整个敏捷研发，包括现如今的DevOps也只是浅尝辄止，害怕误人子弟和广告嫌疑。笔者一方面作为敏捷研发的实践者，另一方面作为敏捷研发的受益者。站在这两层身份上，浅谈下TAPD和敏捷研发。</p>
<h2 id="TAPD介绍"><a href="#TAPD介绍" class="headerlink" title="TAPD介绍"></a>TAPD介绍</h2><p>TAPD，是腾讯敏捷产品研发平台，强调敏捷迭代、小步快跑，使用范围包含腾讯和腾讯的合作伙伴，是腾讯敏捷研发的精髓，支撑腾讯数以万计的产品研发和协同。目前TAPD已开放SaaS服务，助力业界提升团队研发效率。<a href="http://www.tapd.cn/" target="_blank" rel="noopener">http://www.tapd.cn/</a></p>
<h2 id="敏捷研发"><a href="#敏捷研发" class="headerlink" title="敏捷研发"></a>敏捷研发</h2><p>最早接触软件研发方法论是在大学软件工程的课程上。老师给我们讲的是瀑布模型，毕业设计也是按照瀑布模型的方式完成的。可行性研究，需求分析，基本设计，详细设计，编码，测试，维护。这种开发模式对传统大型软件研发是很适用的。完善的开发流程，精细的设计，详尽的文档，角色各司其职，对软件质量和维护有很强的适应性。</p>
<p>毕业后，从事互联网工作，开始了敏捷研发的”熏陶”。起初对这种方式有些排斥，经常开会（晨会，需求评审，测试用例）。需求经常变更。没有时间顾及代码质量。进入新项目时，需要看旧代码才能理解设计意图，看别人的代码更是一种痛苦。对开发人员来说，没有注释和文档的代码，真是一种煎熬。在紧凑的迭代周期中，代码设计也没法顾虑过多，反复的变更导致代码可读性差。</p>
<p>公司存在的目的是盈利，蛋糕只有这么大，快速占领市场才是王炸。敏捷研发对互联网公司来说，尤其是移动互联网软件开发而言是更适应的。敏捷研发的核心在于快速迭代，拥抱变化。目标是让客户满意(以用户价值为依归)，保证软件灵活度以适应极速变化的市场。通俗一点说，更快的适应市场，更好的赚钱。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2018/03/25/tapd/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2017/06/23/tencent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/23/tencent/" itemprop="url">
                  公司那些事
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/06/23/tencent/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/06/23/tencent/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/06/23/tencent/" class="leancloud_visitors" data-flag-title="公司那些事">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>毕业一年了，上上下下经历了不少公司。自己创过业，也在B轮公司待过，也在D轮做过事，另外也在上市公司做过螺丝钉。林林总总算下来，也有五家公司了。也是挺折腾的。经常有人会觉得，这小伙沉不下来。其实对应聘者而言，反反复复更换工作，当然有其不好之处。</p>
<p>但从另一方面考虑有些人为什么会频繁更换工作呢？人往往喜欢待在舒适区，待久了一个地方就懒的去更换巢穴。频繁的跳出舒适区，也是对自己发展现状不满意的宣泄。这也是对笔者频繁更换工作的一种解释吧。我是觉得适当时机跳出舒适区，是对个人职业发展的追求。</p>
<p>入职腾讯也有两周了，这期间经常有人问我腾讯的面试情况。在不违反公司制度的前提下，我会简单介绍有关问题。其次会比较下我目前待过几家公司的特点。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/06/23/tencent/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2017/05/31/yii2-plus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/31/yii2-plus/" itemprop="url">
                  yii2-plus
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/31/yii2-plus/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/31/yii2-plus/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/05/31/yii2-plus/" class="leancloud_visitors" data-flag-title="yii2-plus">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://github.com/gglinux/Yii2-Plus" target="_blank" rel="noopener">yii2-plus</a>，是基于yii2.0的脚手架项目。支持restapi，Admin(管理后台)，Web（www服务），服务化。集成JWT、Hprose、推送、队列、Element UI。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/05/31/yii2-plus/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2017/05/03/php_extensions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/03/php_extensions/" itemprop="url">
                  PHP C扩展开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/03/php_extensions/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/03/php_extensions/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/05/03/php_extensions/" class="leancloud_visitors" data-flag-title="PHP C扩展开发">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>对PHP C扩展开发感兴趣的同学可以看下，项目包含8个demo，每个demo都可抽离出来独立运行。相比较使用ext_skel生成的骨架，demo会更好理解（只包含核心方法）。每个demo都有相应的测试文件和运行文档，另外代码中也会有较详细的注释。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/05/03/php_extensions/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2017/04/19/books/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/19/books/" itemprop="url">
                  书籍推荐
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/19/books/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/04/19/books/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/04/19/books/" class="leancloud_visitors" data-flag-title="书籍推荐">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>这几年，看了一些书。罗列出来，希望能给需要的人一些借鉴。正好在找工作，也能复习下。当然笔者是计科毕业的，专业书除外。后续的一些书籍信息，也会更新到这里。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/04/19/books/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://gglinux.com/2017/04/15/IM_design/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="gglinux">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/dog.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gglinux's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/15/IM_design/" itemprop="url">
                  IM系统设计
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/15/IM_design/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/04/15/IM_design/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/04/15/IM_design/" class="leancloud_visitors" data-flag-title="IM系统设计">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="http://baike.baidu.com/link?url=_W4LMyBxK7gcYGkisHQJB5bDpg9iqbBJd9ydWWGDEzmfKHwWBV6dORgTMZl5Ujqjlo8a0-KSxFAkcWb0uoXFsa7gw4gN8Uw2FSZl6bKQi1-lcd3b1c-MTDM2YMF6ZsDp" target="_blank" rel="noopener">即时通讯</a>（Instant Messaging，简称IM）是一个实时通信系统，允许两人或多人使用网络实时的传递文字消息、文件、语音与视频交流。实现方式有两种。第一种基于Server转发的，Client双方通信会经过Server转发来完成消息传递。例如QQ、微信。</p>
<p>第二种是基于P2P(点对点)的。P2P的实现依赖于客户端之间的互联，但由于NAT与防火墙的存在，客户端无法直接互联，需要<a href="https://github.com/coturn/coturn" target="_blank" rel="noopener">coturn服务器</a>用来穿越NAT网络。</p>
<p>本文主要讲述基于Server转发实现的即时通讯原理和实现过程，包括私聊和群聊两类。私聊和群聊，原理基本类似，但私聊是单次转发,群聊属于遍历转发。不同点为，群聊以群ID（多人）划分，私聊以会话ID（两人）划分，其次消息存储上也有较大差异。</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/04/15/IM_design/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/dog.png"
               alt="gglinux" />
          <p class="site-author-name" itemprop="name">gglinux</p>
           
              <p class="site-description motion-element" itemprop="description">恭喜发财</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/gglinux" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/gglinuxgjw" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/gglinux" target="_blank" title="ZhiHu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  ZhiHu
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/gglinux" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">gglinux</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://gglinux.disqus.com/count.js" async></script>
    

    

  













  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("XymU2aqjxbkNIIj76bD6VOpw-gzGzoHsz", "YLyX4iTTipCTV2dxyDawA5BB");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

</body>
</html>
